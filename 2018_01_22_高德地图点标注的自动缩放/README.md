在数据可视化展示系统中，地理信息系统（GIS）组件已经几乎是必备的标配了。

GIS组件通过地图的形式直观地展现数据项在地理上的分部，以地图上点标注（Marker）的颜色、大小等表示数据量。在可交互系统中，还可通过点击点标注弹出或跳转详情页面，或实现各种LBS（基于位置的服务）。

GIS组件往往位于展示大屏主页面的中心位置，或作为整体背景，例如以下两图（图片来自阿里云DataV官网），其重要性可见一斑。

![1](1.jpg)

![2](2.jpg)

在通用的数据可视化系统中，我们可以使用[高德地图](http://lbs.amap.com/)或[百度地图](http://lbsyun.baidu.com/)等第三方平台提供的API或SDK，实现所需的GIS组件。

最近在做工业云的平板客户端，其中就有GIS系统的需求，该GIS系统是作为管理工程项目的导航入口，通过地图上的点标注反映用户所拥有项目的地理位置，可点击选择弹出详情组件和进入管理页面。

与数据可视化大屏中的GIS系统比较，除了常见的要求外，要着重注意两点：

- 由于是工业云的客户端而非定制的展示系统，用户项目的数量、分布千差万别，可能只有同城的几个项目，也可能分布全国的几百个项目，或者可能有海外项目。
- 该系统最主要的目标是作为管理工程项目的导航入口，因此更注重交互体验，不管是持有多少项目的用户，都希望有一个便捷的方式方便其聚焦选择所需项目。

#Web vs Native

该项目使用React Native开发，GIS系统选用高德地图。

目前高德地图支持的开发方式有Web API与原生SDK两种。对于React Native的架构来说，分别可以通过Webview或封装原生模块的方式来实现。

按照一般的观念，从性能角度讲，原生模块都是大大优于Webview的。但是经过调研与实验，无论是Web API还是原生SDK，地图图层的渲染内容高德都是通过网络远程获取的，远程加载速度是最主要的性能瓶颈，因此原生SDK的渲染和计算优势并不会带来多大的体验提升。

而采用Web方式则具有很明显的跨平台通用性和开发调试的方便性，因此我们采用Web方式。

# 自动聚焦与缩放

为了满足前文所述的两个注意点，我们希望已进入GIS页面时，地图就满足以下要求：

- 地图视域的中心就是项目地理分部的中心；
- 地图视域缩放到既能容纳所有项目，又能使他们尽量分散布满全屏；

由于屏幕是一个矩形，这两个问题不同于一般的分布中心问题，可以按照这样的思路考虑：想象地理上有一个矩形，分别以所有项目坐标中，经度最高和最低的两条经线为竖边，纬度最高和最低的两条纬线为横边，那么这个矩形就是能放下所有项目的最小矩形，它的中心点就是我们要找的屏幕中心，把它缩放到屏幕刚好能放下的比例就是我们要找的比例。

按照这个思路，我们就可以开发GIS组件了。

关于Webview中如何引入高德Web API就不赘述了。为方便使用React Native组件的变量，我们将业务逻辑的脚本通过模板字符串生成，并通过`injectedJavaScript`参数注入Webview。

#点选事件与消息通信